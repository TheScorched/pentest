#!/bin/bash

network_range="192.168.8.xxx.xxx/24" #Replace with your internal IP address

# Output dir
output_dir="./scan_results"
mkdir -p "$output_dir"

# Store live hosts
live_hosts="$output_dir/live_hosts.txt"

# Network scan
echo "Scanning for live hosts in the network range $network_range..."
nmap -sn $network_range -oG - | awk '/Up$/{print $2}' > "$live_hosts"

if [ ! -s "$live_hosts" ]; then
    echo "No live hosts found in the network range $network_range."
    exit 1
fi

echo "Live hosts found. Starting port scanning..."

# Pull from live hosts and perform port scan
while read -r host; do
    echo "Scanning $host for open ports..."
    nmap -sV -p- "$host" -oN "$output_dir/port_scan_$host.txt"
done < "$live_hosts"

echo "Scanning complete. Results are stored in $output_dir."
